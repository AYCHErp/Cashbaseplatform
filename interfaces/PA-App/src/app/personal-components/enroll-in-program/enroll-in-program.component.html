<section>
  <dialogue-turn [actor]="programDetails?.ngo"
                 [hidden]="!programDetails?.title"
  >
    <p [innerHTML]="'personal.enroll-in-program.introduction'|translate:{ programTitle:programDetails?.title, ngo:programDetails?.ngo }"></p>
    <p>
      {{ 'personal.enroll-in-program.introduction-questions'|translate }}
    </p>
    <p>
      <more-info-button [message]="'personal.enroll-in-program.info-message'|translate"
                        [heading]="'personal.enroll-in-program.more-info-questions'|translate"
      >
        {{ 'personal.enroll-in-program.more-info-questions'|translate }}
      </more-info-button>
    </p>
  </dialogue-turn>
  <dialogue-turn actor="self"
                 *ngFor="let question of questions; let i=index; first as isFirst;"
                [isConnected]="!isFirst"
                [isSpoken]="isFirst || hasAnswered || hasChangedAnswers"
  >
    <ion-label>
      {{ question.label }}
    </ion-label>
    <div [ngSwitch]="question.answerType">
      <div *ngSwitchCase="answerTypes.Enum">
        <ion-radio-group [name]="question.code"
                         (ionChange)="onAnswerChange(question.code,$event.target.value)"
                         debounce="100"
        >
          <ion-item *ngFor="let option of question.options"
                    color="light"
          >
            <ion-label>{{ option.label }}</ion-label>
            <ion-radio [value]="option.value"
                       [checked]="(option.value === answers[question.code]?.value)"
                       [disabled]="hasAnswered"
            ></ion-radio>
          </ion-item>
        </ion-radio-group>
      </div>
      <div *ngSwitchCase="answerTypes.Number">
        <ion-input type="number"
                   inputmode="numeric"
                   pattern="[0-9]*"
                   [name]="question.code"
                   [value]="answers[question.code]?.value"
                   [disabled]="hasAnswered"
                   (ionChange)="onAnswerChange(question.code,$event.target.value)"
                   debounce="300"
        ></ion-input>
      </div>
      <div *ngSwitchCase="answerTypes.Date">
        <ion-input type="date"
                   placeholder="dd-mm-yyyy"
                   [name]="question.code"
                   [value]="answers[question.code]?.value"
                   [disabled]="hasAnswered"
                   (ionChange)="onAnswerChange(question.code,$event.target.value)"
                   debounce="100"
        ></ion-input>
      </div>
      <div *ngSwitchDefault>
        <ion-input type="text"
                   [name]="question.code"
                   [value]="answers[question.code]?.value"
                   [disabled]="hasAnswered"
                   (ionChange)="onAnswerChange(question.code,$event.target.value)"
                   debounce="300"
        ></ion-input>
      </div>
    </div>
  </dialogue-turn>
  <dialogue-turn actor="self"
                 isConnected="true"
                 *ngIf="allQuestionsShown"
                 [isSpoken]="allQuestionsShown"
  >
    <p>
      <ion-button type="submit"
                  (click)="submit()"
                  [disabled]="hasAnswered"
                  expand="block"
      >
        {{ 'personal.enroll-in-program.submit'|translate }}
      </ion-button>
    </p>
  </dialogue-turn>
  <dialogue-turn [actor]="programDetails?.ngo"
                 *ngIf="dobFeedback"
                 [isSpoken]="dobFeedback"
  >
    <p>
      {{ 'personal.enroll-in-program.dob-feedback'|translate }}
    </p>
  </dialogue-turn>
  <dialogue-turn [actor]="programDetails?.ngo"
                 *ngIf="hasAnswered"
                 [isSpoken]="hasAnswered"
  >
    <p>
      {{ 'personal.enroll-in-program.please-confirm'|translate }}
    </p>
    <p>
      <more-info-button [message]="'personal.enroll-in-program.info-message-share'|translate"
                        [heading]="'personal.enroll-in-program.more-info-share'|translate"
      >
        {{ 'personal.enroll-in-program.more-info-share'|translate }}
      </more-info-button>
    </p>
  </dialogue-turn>
  <dialogue-turn actor="self"
                 *ngIf="hasAnswered"
                 [isSpoken]="hasAnswered"
  >
    <ul>
      <li *ngFor="let question of questions">
        {{ question.label }}<br>
        <strong>{{ answers[question.code]?.label }}</strong>
      </li>
    </ul>

    <p class="ion-margin-top">
      <ion-button type="submit"
                  (click)="submitConfirm()"
                  [disabled]="isDisabled"
                  expand="block"
      >
        {{ 'personal.enroll-in-program.submit-confirm'|translate }}
      </ion-button>
      <ion-button type="button"
                  (click)="changeAnswers()"
                  [disabled]="isDisabled"
                  expand="block"
                  fill="outline"
      >
        {{ 'personal.enroll-in-program.change'|translate }}
      </ion-button>
    </p>
  </dialogue-turn>
</section>
